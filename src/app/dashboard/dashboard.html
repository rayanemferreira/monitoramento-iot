<div class="grid dashboard">

  
  @for (device of Dispositivos; track device.name; let i = $index) {
    @if (device.category_id == 1) {
      <mat-card appearance="raised" class="card device-card" 
        [ngClass]="['status-' + device.status, 'device-' + i]">
        
        <mat-card-header>
          <mat-card-title>{{ device.name | titlecase }}</mat-card-title>
          <mat-card-subtitle>Status — {{ device.status | uppercase }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <div class="device-row">
            <span [class.on]="device.on">{{ device.on ? 'Ligado' : 'Desligado' }}</span>
            <mat-slide-toggle [(ngModel)]="device.on">Alternar</mat-slide-toggle>
          </div>

          <div class="actions">
            <button mat-stroked-button color="primary" (click)="openHistory(device)">
              Histórico
            </button>
          </div>
        </mat-card-content>

      </mat-card>
    }
  }

  @for (sensor of getRealTimeDevices(2); track sensor.id) {
    <mat-card appearance="raised" class="card chart-card">
      <mat-card-header>
        <mat-card-title>Tanque de água — {{ sensor.name | titlecase }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-wrapper half-circle">
          <canvas baseChart [type]="'doughnut'" 
                  [data]="buildDoughnutData(sensor.value)" 
                  [options]="gaugeChartOptions"></canvas>
          <div class="chart-center">
            {{ sensor.value }}<span class="unit">%</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  }

  @for (sensor of getRealTimeDevices(3); track sensor.id) {
    <mat-card appearance="raised" class="card">
      <mat-card-header>
        <mat-card-title>Umidade — {{ sensor.name | titlecase }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-big">{{ sensor.value }}<span class="unit">%</span></div>
        <div class="muted">10m ago</div>
      </mat-card-content>
    </mat-card>
  }

  @for (sensor of getRealTimeDevices(4); track sensor.id) {
    <mat-card appearance="raised" class="card">
      <mat-card-header>
        <mat-card-title>Temperatura externa — {{ sensor.name | titlecase }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-big">{{ sensor.value }}<span class="unit">°C</span></div>
        <div class="muted">10m ago</div>
      </mat-card-content>
    </mat-card>
  }

  @for (sensor of getRealTimeDevices(4); track sensor.id) {
    <mat-card appearance="raised" class="card chart-card">
      <mat-card-header>
        <mat-card-title>Temperatura e umidade — {{ sensor.name | titlecase }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-wrapper">
          @if (isBrowser) {
            <canvas baseChart [type]="'line'" 
                    [data]="humChartData" 
                    [options]="lineChartOptions"></canvas>
          }
        </div>
      </mat-card-content>
    </mat-card>
  }


  @for (sensor of getRealTimeDevices(5); track sensor.id) {
    <mat-card appearance="raised" class="card chart-card">
      <mat-card-header>
        <mat-card-title>Nível de água — {{ sensor.name | titlecase }}</mat-card-title>
        <mat-card-subtitle>Categoria — {{ sensor.category }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-wrapper">
             <canvas baseChart [type]="'doughnut'"
                    [data]="buildDoughnutData(sensor.value)"
                    [options]="waterChartOptions"></canvas>
      
          <div class="chart-center">{{ sensor.value }}</div>
          <div class="muted">10m ago</div>
        </div>
      </mat-card-content>
    </mat-card>
  }



  <button mat-stroked-button color="primary" (click)="goToDispositivos()">
    Gerenciar Dispositivos
  </button>
</div>
